<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>薄透鏡成像互動模擬 - Thin Lens Equation</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; background: #f4f4f4; }
        .controls { display: flex; gap: 15px; margin-bottom: 15px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex-wrap: wrap; }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #333; }
        input { width: 150px; padding: 5px; }
        canvas { border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .info { margin-top: 10px; color: #666; font-size: 14px; }
    </style>
</head>
<body>

    <h2>薄透鏡成像互動模擬</h2>
    
    <div class="controls">
        <div class="input-group">
            <label>物距 p: <span id="val_p">60</span> cm</label>
            <input type="range" id="input_p" min="5" max="150" value="60" step="1">
        </div>
        <div class="input-group">
            <label>焦距 f: <span id="val_f">40</span> cm (正值為凸，負值為凹)</label>
            <input type="range" id="input_f" min="-100" max="100" value="40" step="1">
        </div>
    </div>

    <div id="canvas-container"></div>
    <div class="info">※ 綠色為物體 (O)，紅色為像 (I)，橘色為焦點 (F)。</div>

<script>
let p, f;
let offsetX = 400; // 透鏡位置在畫面中心
let scaleFactor = 3;

function setup() {
    let canvas = createCanvas(800, 400);
    canvas.parent('canvas-container');
    
    select('#input_p').input(updateParams);
    select('#input_f').input(updateParams);
    
    updateParams();
    noLoop();
}

function updateParams() {
    p = parseFloat(select('#input_p').value());
    f = parseFloat(select('#input_f').value());
    select('#val_p').html(p);
    select('#val_f').html(f);
    redraw();
}

function draw() {
    background(255);
    translate(offsetX, height / 2);

    // 1. 畫主光軸
    stroke(200);
    strokeWeight(1);
    line(-offsetX, 0, width - offsetX, 0);

    // 2. 畫薄透鏡 (雙箭頭標示)
    stroke(0);
    strokeWeight(2);
    line(0, -150, 0, 150); // 透鏡主體
    
    if (f > 0) {
        // 凸透鏡箭頭 (向外)
        line(0, -150, -10, -140); line(0, -150, 10, -140);
        line(0, 150, -10, 140); line(0, 150, 10, 140);
    } else if (f < 0) {
        // 凹透鏡箭頭 (向內)
        line(0, -150, -10, -160); line(0, -150, 10, -160);
        line(0, 150, -10, 160); line(0, 150, 10, 160);
    }

    // 3. 物理計算: 1/q = 1/f - 1/p
    let q = 1 / ( (1/f) - (1/p) );
    let mag = -q / p;

    let p_px = -p * scaleFactor;
    let q_px = q * scaleFactor;
    let f_px = f * scaleFactor;

    // 4. 畫焦點 F (左右對稱)
    fill(255, 140, 0); noStroke();
    ellipse(f_px, 0, 6, 6); text('F', f_px - 5, 20);
    ellipse(-f_px, 0, 6, 6); text('F', -f_px - 5, 20);

    // 5. 畫物體與像
    // 物體 O
    stroke(0, 128, 0); strokeWeight(3);
    line(p_px, 0, p_px, -50); 
    fill(0, 128, 0); noStroke(); text('O', p_px - 5, -60);

    // 像 I
    if (Math.abs(q) < 5000) { // 避免 q 趨近無限大時崩潰
        stroke(255, 0, 0); strokeWeight(3);
        line(q_px, 0, q_px, -50 * mag);
        fill(255, 0, 0); noStroke(); text(q > 0 ? 'I (Real)' : 'I (Virtual)', q_px - 20, -50 * mag - 10);
    }

    // 6. 繪製三條特殊光線
    strokeWeight(1);
    // (1) 平行主軸光線 -> 過焦點
    stroke(100, 100, 255, 150);
    line(p_px, -50, 0, -50); // 到透鏡
    line(0, -50, q_px, -50 * mag); // 到像點
    
    // (2) 過透鏡中心光線 (不偏折)
    stroke(150, 150, 0, 150);
    line(p_px, -50, q_px, -50 * mag);

    // 7. 數據顯示
    resetMatrix();
    fill(0); noStroke(); textSize(14);
    text(`物距 p: ${p.toFixed(1)} cm`, 20, 40);
    text(`焦距 f: ${f.toFixed(1)} cm`, 20, 60);
    text(`像距 q: ${isFinite(q) ? q.toFixed(1) + " cm" : "無窮遠"}`, 20, 80);
    text(`放大率 M: ${isFinite(mag) ? mag.toFixed(2) : "N/A"}`, 20, 100);
}
</script>
</body>
</html>
