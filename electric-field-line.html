<!DOCTYPE html>
<html>
<head>
    <title>互動式三電荷電力線</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; }
        .ui { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="ui">
        <b>互動電力線模擬</b><br>
        拖曳電荷移動位置<br>
        紅：正電荷 | 藍：負電荷
    </div>

<script>
let charges = [];

function setup() {
    createCanvas(windowWidth, windowHeight);
    // 初始化三個電荷：x, y, 電量q
    charges.push(new Charge(width/2 - 100, height/2, 1));
    charges.push(new Charge(width/2 + 100, height/2, -1));
    charges.push(new Charge(width/2, height/2 - 100, 1));
}

function draw() {
    background(0);
    
    // 繪製電力線 (簡化版：從畫面各處出發)
    stroke(255, 255, 255, 50);
    for (let i = 0; i < width; i += 40) {
        for (let j = 0; j < height; j += 40) {
            drawFieldLine(i, j);
        }
    }

    // 繪製並更新電荷
    for (let c of charges) {
        c.display();
        if (mouseIsPressed && dist(mouseX, mouseY, c.x, c.y) < 20) {
            c.x = mouseX;
            c.y = mouseY;
        }
    }
}

function drawFieldLine(x, y) {
    let px = x;
    let py = y;
    
    beginShape();
    noFill();
    for (let k = 0; k < 10; k++) { // 延伸長度
        let field = createVector(0, 0);
        for (let c of charges) {
            let v = createVector(px - c.x, py - c.y);
            let d = v.mag();
            if (d < 10) return;
            v.normalize();
            v.mult(c.q / (d * d));
            field.add(v);
        }
        field.normalize().mult(5); // 步長
        px += field.x;
        py += field.y;
        vertex(px, py);
    }
    endShape();
}

class Charge {
    constructor(x, y, q) {
        this.x = x;
        this.y = y;
        this.q = q;
    }
    display() {
        noStroke();
        fill(this.q > 0 ? 'red' : 'blue');
        circle(this.x, this.y, 20);
    }
}
</script>
</body>
</html>