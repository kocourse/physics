<!DOCTYPE html>
<html>
<head>
    <title>äº’å‹•å¼ä¸‰é›»è·é›»åŠ›ç·š</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; }
        .ui { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="ui">
        <b>äº’å‹•é›»åŠ›ç·šæ¨¡æ“¬</b><br>
        æ‹–æ›³é›»è·ç§»å‹•ä½ç½®<br>
        ç´…ï¼šæ­£é›»è· | è—ï¼šè² é›»è·
    </div>
<script>
é€™å€‹éŒ¯èª¤ Uncaught ReferenceError: Charge is not defined æ˜¯å› ç‚ºç¨‹å¼åŸ·è¡Œåˆ° new Charge(...) æ™‚ï¼Œé›»è…¦é‚„ä¸èªè­˜ Charge é€™å€‹é¡åˆ¥ï¼ˆClassï¼‰ã€‚é€™é€šå¸¸æœ‰å…©å€‹åŸå› ï¼šä¸€æ˜¯é¡åˆ¥å®šç¾©è¢«åˆªé™¤äº†ï¼ŒäºŒæ˜¯é¡åˆ¥å®šç¾©è¢«æ”¾åœ¨äº†å‘¼å«å®ƒçš„ä»£ç¢¼ä¹‹å¾Œã€‚è¦ç•«å‡ºèª²æœ¬é‚£ç¨®å¹³æ»‘ä¸”æ¯”ä¾‹ç²¾ç¢ºçš„é›»åŠ›ç·šï¼ˆå¦‚æ‚¨æä¾›çš„ $+2q$ èˆ‡ $-q/2$ åœ–ï¼‰ï¼Œæˆ‘å€‘å¿…é ˆæŠŠé¡åˆ¥ã€ç¹ªåœ–ã€ä»¥åŠæ‚¨çš„ã€Œç·¨è™Ÿæª¢æŸ¥ã€é‚è¼¯å®Œæ•´çµ„åˆèµ·ä¾†ã€‚ğŸš€ ä¿®æ­£å¾Œçš„å®Œæ•´ç¨‹å¼ç¢¼ï¼ˆèª²æœ¬ç´šé›»åŠ›ç·šé‚è¼¯ï¼‰è«‹å°‡ä»¥ä¸‹ä»£ç¢¼å…¨é¸ä¸¦æ›¿æ›æ‚¨ç›®å‰çš„è…³æœ¬ã€‚æˆ‘å·²ç¶“æŠŠ Charge é¡åˆ¥ç§»åˆ°æœ€ä¸Šæ–¹ï¼Œä¸¦è£œé½Šäº†æ‰€æœ‰å‡½æ•¸ã€‚JavaScript// 1. å…ˆå®šç¾©é¡åˆ¥ï¼Œç¢ºä¿å¾ŒçºŒ new Charge ä¸æœƒå ±éŒ¯
class Charge {
  constructor(x, y, q, maxLines) {
    this.x = x;
    this.y = y;
    this.q = q;
    this.maxLines = maxLines; // æ‚¨å®šç¾©çš„ï¼šè©²é›»è·æ‡‰å°æ‡‰çš„é›»åŠ›ç·šç¸½æ•¸
    this.connectedCount = 0;  // è¨˜éŒ„å·²ç¶“é€£ä¸Šçš„ç·šæ•¸
    this.isDragging = false;
  }

  update() {
    if (mouseIsPressed) {
      let d = dist(mouseX, mouseY, this.x, this.y);
      if (d < 30 || this.isDragging) {
        this.x = mouseX;
        this.y = mouseY;
        this.isDragging = true;
      }
    } else {
      this.isDragging = false;
    }
  }

  display() {
    noStroke();
    fill(this.q > 0 ? '#d63031' : '#0984e3');
    circle(this.x, this.y, 35);
    stroke(255);
    strokeWeight(2);
    line(this.x - 7, this.y, this.x + 7, this.y);
    if (this.q > 0) line(this.x, this.y - 7, this.x, this.y + 7);
    
    // é¡¯ç¤ºé›»é‡æ–‡å­— (å¦‚ +2q)
    fill(0);
    noStroke();
    textSize(14);
    text(this.q + "q", this.x, this.y + 30);
  }
}
let charges = [];

function setup() {
  createCanvas(600, 600);
  // æ¨¡æ“¬èª²æœ¬ï¼šå·¦é‚Š -q/2 (ç·¨è™Ÿ0), å³é‚Š +2q (ç·¨è™Ÿ1)
  charges.push(new Charge(150, 300, -0.5, 4)); // 4æ¢é…é¡
  charges.push(new Charge(400, 300, 2, 16));   // 16æ¢é…é¡
}

function draw() {
  background(255);

  // æ¯æ¬¡é‡ç•«å‰é‡è¨­ã€Œå·²æ¥æ”¶æ•¸é‡ã€
  for (let c of charges) c.connectedCount = 0;

  // 1. å…ˆè®“æ­£é›»è·ç™¼å°„ (ä¾ç…§ç·¨è™Ÿé †åº)
  for (let c of charges) {
    if (c.q > 0) {
      for (let i = 0; i < c.maxLines; i++) {
        let a = map(i, 0, c.maxLines, 0, TWO_PI);
        let startX = c.x + cos(a) * 15;
        let startY = c.y + sin(a) * 15;
        
        // è¿½è¹¤ä¸¦æ‰¾å‡ºçµ‚é»æ˜¯å“ªå€‹é›»è·
        let target = traceAndDraw(startX, startY, 1); 
        if (target) target.connectedCount++;
      }
    }
  }

  // 2. æª¢æŸ¥è² é›»è·æ˜¯å¦é‚„æœ‰ã€Œæœªå¡«æ»¿ã€çš„é…é¡ (ä¾†è‡ªç„¡çª®é çš„ç·š)
  for (let c of charges) {
    if (c.q < 0) {
      let remaining = c.maxLines - c.connectedCount;
      for (let i = 0; i < remaining; i++) {
        // åœ¨å‰©é¤˜çš„ç©ºé–“ä¸­å‡å‹»ç™¼å°„ï¼ˆåå‘è¿½è¹¤ï¼‰
        let a = map(i, 0, remaining, 0, TWO_PI);
        let startX = c.x + cos(a) * 15;
        let startY = c.y + sin(a) * 15;
        traceAndDraw(startX, startY, -1);
      }
    }
  }

  for (let c of charges) { c.display(); c.update(); }
}

function traceAndDraw(sx, sy, dir) {
  let px = sx, py = sy;
  beginShape();
  noFill();
  stroke(100, 150);
  
  for (let k = 0; k < 500; k++) {
    vertex(px, py);
    let E = calculateE(px, py);
    if (E.mag() < 0.01) break;

    // æª¢æŸ¥æ˜¯å¦æ’åˆ°ã€Œå…¶ä»–ã€é›»è·
    let hit = null;
    for (let c of charges) {
      if (dist(px, py, c.x, c.y) < 15 && k > 5) { hit = c; break; }
    }
    
    if (hit) {
      endShape();
      drawArrowOnLine(px, py, E.heading(), dir); // ç¢ºä¿ç®­é ­ç‰©ç†æ­£ç¢º
      return hit; 
    }

    let step = E.normalize().mult(4 * dir);
    px += step.x; py += step.y;

    if (px < -50 || px > width+50 || py < -50 || py > height+50) break;
  }
  endShape();
  return null;
}
</script>
</body>
</html>



















