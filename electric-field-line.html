<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>äº’å‹•å¼ä¸‰é›»è·é›»åŠ›ç·š (å¸¶ç®­é ­ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        .ui { position: absolute; top: 15px; left: 15px; color: white; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; pointer-events: none; font-family: sans-serif; }
    </style>
</head>
<body>
    <div class="ui">
        <b>ğŸ”‹ ç‰©ç†æ¨¡æ“¬ï¼šé›»åŠ›ç·šèˆ‡æ–¹å‘ç®­é ­</b><br>
        â€¢ æ»‘é¼ æ‹–æ›³é›»è·ç§»å‹•<br>
        â€¢ ç´…è‰²ï¼šæ­£é›» (+1) | è—è‰²ï¼šè² é›» (-1)
    </div>

<script>
let charges = [];

function setup() {
    createCanvas(windowWidth, windowHeight);
    // åˆå§‹åŒ–é›»è·ï¼šx, y, q (é›»é‡)
    charges.push(new Charge(width/2 - 150, height/2, 1));
    charges.push(new Charge(width/2 + 150, height/2, -1));
    charges.push(new Charge(width/2, height/2 - 150, 1));
}

function draw() {
    background(0);
    
    // ç¹ªè£½æ ¼é»å‡ºç™¼çš„é›»åŠ›ç·š
    let density = 45; // èª¿æ•´é€™å€‹æ•¸å€¼å¯ä»¥æ”¹è®Šå ´ç·šå¯†åº¦
    for (let i = 0; i <= width; i += density) {
        for (let j = 0; j <= height; j += density) {
            drawFieldLine(i, j);
        }
    }

    // è™•ç†èˆ‡é¡¯ç¤ºé›»è·
    for (let c of charges) {
        c.update();
        c.display();
    }
}

function drawFieldLine(x, y) {
    let px = x;
    let py = y;
    let steps = 12; // æ¯æ¢ç·šå»¶ä¼¸çš„æ®µæ•¸
    let stepSize = 8; // æ¯æ®µçš„é•·åº¦
    
    noFill();
    stroke(255, 255, 255, 60); // åŠé€æ˜ç™½ç·š
    beginShape();
    
    for (let k = 0; k < steps; k++) {
        let totalE = createVector(0, 0);
        
        // è¨ˆç®—ç¸½é›»å ´å‘é‡
        for (let c of charges) {
            let r = createVector(px - c.x, py - c.y);
            let d = r.mag();
            
            if (d < 15) { // è·é›¢å¤ªè¿‘å‰‡åœæ­¢ç¹ªè£½ï¼Œé¿å…é™¤ä»¥é›¶
                endShape();
                return;
            }
            
            r.normalize();
            // E = kQ/r^2
            r.mult(c.q / (d * d) * 5000); 
            totalE.add(r);
        }
        
        // å–å¾—è©²é»æ–¹å‘ä¸¦ç¹ªè£½
        let angle = totalE.heading();
        vertex(px, py);
        
        // åœ¨ç·šæ®µä¸­é»è™•ç•«ç®­é ­ (k=6 æ˜¯å¤§ç´„ä¸€åŠçš„ä½ç½®)
        if (k === 6) {
            drawArrowHead(px, py, angle);
        }
        
        totalE.normalize().mult(stepSize);
        px += totalE.x;
        py += totalE.y;
    }
    endShape();
}

function drawArrowHead(x, y, angle) {
    push();
    translate(x, y);
    rotate(angle);
    fill(255, 255, 255, 180);
    noStroke();
    let sz = 6;
    triangle(sz, 0, -sz, -sz * 0.7, -sz, sz * 0.7);
    pop();
}

class Charge {
    constructor(x, y, q) {
        this.x = x;
        this.y = y;
        this.q = q;
        this.isDragging = false;
    }
    
    update() {
        if (mouseIsPressed) {
            if (dist(mouseX, mouseY, this.x, this.y) < 25 || this.isDragging) {
                this.x = mouseX;
                this.y = mouseY;
                this.isDragging = true;
            }
        } else {
            this.isDragging = false;
        }
    }
    
    display() {
        noStroke();
        fill(this.q > 0 ? '#ff4757' : '#2f3542');
        circle(this.x, this.y, 25);
        fill(255);
        textAlign(CENTER, CENTER);
        text(this.q > 0 ? "+" : "-", this.x, this.y);
    }
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
